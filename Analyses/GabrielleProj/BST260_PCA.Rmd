---
title: "Gapminder Exploration: Pricinpal Component Analysis"
author: "Gabrielle LaRosa"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
rm(list=ls())
knitr::opts_chunk$set(echo = TRUE)
```

## Overview and Motivation:
The goal of this analysis is to use Principal Component Analysis (PCA) as a dimension reduction technique for the gapminder data. **We are interested in uncovering broad patterns between location (continent) and the health/economic features of a region**. If the health spending and health outcome features of a country is related to it's location, then we expect PCA to uncover that the data is clustered by continent once plotted on it's first and second principle components.

PCA will allow us to derive a low dimentional feature set from 8 different covariates relating to country's health spending and health status. From there, we can plot a scatterplot of the first two principal components, which presents a better method for visualizing n observations on p features without having p(p-1)/2 scatterplots.


## Related Work
This section of our project was inspired by our need for a technique to vizualize data with many covariates/features. Thus, online resourses and a textbook [Introduction to Statistical Learning] served as an inspiration for using Principal Component Analysis as a dimension reduction technique. In addition, Dr. Mattie's input and her provided old notes on PCA was helpful for inspiring our analyses.


## Question
**Do countries within the same continent share similar health and economic features?**



## Analysis: Principal Component Analysis (PCA)

We are using PCA to reduce the dimension of the gapminder data and analyze if our new components explain the variation between continents. Out goal is to explore if continents are that different from each other using economic and health variables such as the GINI coefficient (income inequality), government spending, life expectancy, dalys, number of doctors, youth ratio, citizen oThis is an unsupervised learning technique, meaning that PCA reduces the dimensions of out data without using "continent" information. Then, we can go back to the PCA plot, label points by continent, and see if the data has clustering based on continent. Essentially, this will allow us to better visualize what is going on with our dat without having to plot an absurd number of scatterplots. We are trying to reduce the number of variables in a dataset while preseving as much information as possible and extracting patterns in the data.


From the gapminder data are using the following features that characterize the health and economic status of a country:
$X_1$ = Child Mortality Rate,
$X_2$ = Life Expectancy,
$X_3$ = DALYs,
$X_4$ = GINI Coefficient,
$X_5$ = GDP per capita,
$X_6$ = Child/Elderly Ratio,
$X_7$ = Government Spending (% of total),
$X_8$ = Total Health Spending,
$X_9$ = Government Share of Health Spending,
$X_10$ = Private Share of Health Spending.

In R, we can implement Principal Component Analysis using the prcomp function from the stats package. We feed the prcomp function a data matrix containing the data information without the continent information included. Then, the calculation is done using singular value decomposition on this data matrix and returns the standard deviations of the principal components. 

Once prcomp is computed, we can take the information from the first two principal components, where the first principal component explains the largest amount of variability in the data, while the second principal component explains the next largest amount of variability. In addition, we can extract the loadings of the PCA, which are the coefficients of the linear combination of features from the principal component analysis. We will repeat this process for both 1995 and 2010, and examine if different patterns emerge after a 15-year time lapse.



```{r, echo=FALSE, message=FALSE, include=FALSE}
#loading necessary libraries
library(tidyverse)
library(ggplot2)
library(gapminder)
library(cluster)
library(MASS)
library(dplyr)
library(magrittr)

#Reading in data (after my (Gabrielle) and Alana's data cleaning)
health <- read.csv("savingthehealthcarecrisis.csv")

#The below code for labeling our data with continent information was helped with from Rebecca :)

#Reading in the gapminder data from the R gapminder library
data(gapminder)

#Selecting only the country and continent information from the gapminder data
gapminder <- gapminder %>%
  dplyr::select(country, continent)
 
#Joining continent information to our data ("health")
new_health <- left_join(health, gapminder, by = c("country"))

#Sorting and cleaning data
sort(setdiff(new_health$country,gapminder$country))
new_health$continent[] <- lapply(new_health$continent, as.character)


#give a continent to those different in gapminder
new_health$continent[new_health$country=="Afghanistan"] <- "Asia"
new_health$continent[new_health$country== "Myanmar"] <- "Asia"
new_health$continent[new_health$country== "Sao Tome and Principe"] <- "Africa"
new_health$continent[new_health$country== "Somalia"] <- "Africa"
new_health<-unique(new_health[,])
new_health<-new_health[complete.cases(new_health),]

```


### Year 1995 Analysis
```{r , echo=FALSE,  message=FALSE, optionwarning=FALSE}
#Loading necessary libraries:
library(devtools)
library(ggplot2)
library(ggfortify)

#Creating subset of data that contains only 1995 data
health_1995<-new_health[new_health$year==1995,]

#Cleaning data of NAs
health_1995<-health_1995[complete.cases(health_1995),]

#Selecting our predefined features of interest, without continent information
df_1995_unlabeled<-health_1995[c("child_mortality","life_expectancy", "dalys", "GINI_coef", "GDP_percap", "child_elderly_per100", "govspending_percentoftotal", "total_healthspending", "gov_share_healthspending", "privateshare")]

#Selecting our predefined features of interest, with continent information
df_1995_labeled<-health_1995[c("child_mortality","life_expectancy", "dalys", "GINI_coef", "GDP_percap", "child_elderly_per100", "govspending_percentoftotal", "total_healthspending", "gov_share_healthspending", "privateshare", "continent")]


#pca<-prcomp(df_1995_unlabeled, scale.=TRUE)

#Performing PCA on the UNLABELED data
pca<-prcomp(df_1995_unlabeled)

#Plotting the data on PC1 vs PC2, then going back and coloring by continent
autoplot(pca, loadings=FALSE, loadings.label=FALSE, data=df_1995_labeled, colour='continent', main="Principal Component Analysis, 1995")

#Plotting the data on PC1 vs PC2, then going back and coloring by continent, and adding loadings vectors onto plot
autoplot(pca, loadings=TRUE, loadings.label=TRUE, data=df_1995_labeled, colour='continent', main="Principal Component Analysis, 1995") 

#Cluster Analysis for 1995:
autoplot(pam(df_1995_labeled[-8],3), frame=TRUE, frame.type='norm', main="Cluster Analysis for 1995")

```



### Year 2010 Analysis
```{r , echo=FALSE, message=FALSE, optionwarning=FALSE}
#loading required libraries
library(devtools)
library(ggplot2)
library(ggfortify)

#Creating a subset of the 2010 data
health_2010<-new_health[new_health$year==2010,]

#Selecting our features of interest without continent information
df_2010_unlabeled<-health_2010[c("child_mortality","life_expectancy", "dalys", "GINI_coef", "GDP_percap", "child_elderly_per100", "govspending_percentoftotal", "total_healthspending", "gov_share_healthspending", "privateshare")]

#Selecting our feature information with continent information
df_2010_labeled<-health_2010[c("child_mortality","life_expectancy", "dalys", "GINI_coef", "GDP_percap", "child_elderly_per100", "govspending_percentoftotal", "total_healthspending", "gov_share_healthspending", "privateshare", "continent")]


##PCA for 2010:
#pca<-prcomp(df_2010_unlabeled, scale.=TRUE)
pca<-prcomp(df_2010_unlabeled)

#Plotting pca results of PC1 and PC2 then coloring by continent information
autoplot(pca, loadings=FALSE, loadings.label=FALSE, data=df_2010_labeled, colour='continent', main="Principal Component Analysis,2010")

#Plotting pca results of PC1 and PC2 then coloring by continent information and adding loadings vectors
autoplot(pca, loadings=TRUE, loadings.label=TRUE, data=df_2010_labeled, colour='continent', main="Principal Component Analysis, 2010") ##loadings included in this one

#Cluster Analysis for 2010:
autoplot(pam(df_2010_labeled[-8],3), frame=TRUE, frame.type='norm', main="Cluster Analysis for 2010")

```



## Conclusions
In the Principal Component Analysis for the 1995 gapminder data, we see that the first two principal components explain 100% of the variability of the data, with the first principal component explaining 91% and the second principal component explaing 9%. Thus, it appears the PCA successfully reduced the 1995 data down to 2 dimensions. When examining the PCA plot, we are looking for any distinct clustering by continent. In the 1995 data, we see that Europe and Africa form the two most distinct clusters. However, these are not distinct clusters since there are still a few data points from other continents that are not separable from the African or European clustering. In addition, the Americas seem to be forming a slight cluster, with points from Asis and Oceania being more scattered.

There is a similar pattern from the 2010 data, with the first principal component explaining 78.12% of the variability in the data and the second principal component explaining 21.88% of the variability in the data. We see again the pattern of Europe and Africa forming the two most distinct clusters.

In addition, both the 1995 and 2010 PCA plots include the loading vectors. This shows us that the DALYs and GDP percent of total spending features are the variables that are defining the clusters the most, since the loadings are the weights of the linear combination of the variables in PCA.


It is also of note that performing cluster analysis using the "partitioning around mediods" technique shows us that there are three general clusters in the data for both 1995 and 2010. When observing both the cluster analysis for 1995 and 2010 along side their respective PCA plots, we see that these clusters loosely correspond to Africa, the Americas, and Europe, while Oceania and Asia are not forming distinct clusters. This tells us that given information on health and economic features of a country, we may be able to predict if this country falls in Africa, the Americas, or Europe, but we are less likely to know if this country is location in Oceania or Asia.

Overall, from the unsupervised clustering technique of Principal Component Analysis (PCA), we see that after decomposing the data, the continents are somewhat clustering together but into distinct, fully separable clusters based on health and economic features of the regions.
 






